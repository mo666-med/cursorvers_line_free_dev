# Line Actions Hardening – Task Breakdown

| Priority | Task (Design Ref) | Objective | Suggested Owner | Key Artifacts | Definition of Done | Validation & Tests | Dependencies | Status |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| P0 | Workflow Inventory Guard ([Design §3.1](design.md#31-workflow-inventory--ownership-ac1)) | Extend the generator and CI guard so `docs/automation/WORKFLOWS.md` stays authoritative. | DevOps | `scripts/automation/generate-workflow-inventory.mjs`, `docs/automation/WORKFLOWS.md`, `.github/workflows/node-tests.yml`, `.sdd/steering/tech.md` | Inventory script outputs triggers, permissions, owners; doc regenerated; steering doc links updated. | `npm run workflows:inventory`, new CI job diff check, `actionlint` | None | ✅ Done |
| P0 | Vendor Manifest Locking ([Design §3.2](design.md#32-vendored-helper-packaging-ac2)) | Add `manifest.lock.json`, enforce checksum verification, and document refresh flow. | DevOps / Backend | `scripts/vendor/manifest.json`, `scripts/vendor/manifest.lock.json`, `scripts/vendor/sync.mjs`, `package.json`, `.github/workflows/node-tests.yml` | Lock file committed with digests; `vendor:verify` fails on drift; workflows reference only local helpers. | `npm run vendor:sync`, `npm run vendor:verify`, `npm test` (vendor fixtures) | Workflow Inventory Guard | ✅ Done |
| P0 | Router Consolidation Polish ([Design §3.3](design.md#33-router-consolidation-ac3)) | Finalize single router workflow and unit-tested dispatcher. | Developer Experience | `.github/workflows/webhook-handler.yml`, `scripts/webhook-router.mjs`, `tests/actions/webhook-router.test.mjs` | Legacy routers removed; router workflow delegates to script; dispatcher covers documented events. | `npm run test:actions`, `actionlint`, optional `act` smoke (router scenario) | Vendor Manifest Locking | ✅ Done |
| P0 | Config Validation & Runtime Registry ([Design §3.4](design.md#34-pre-flight-config-validation-ac4), [§3.8](design.md#38-runtime-parameter-registry--cli-ac8)) | Generalize validation manifest, add runtime parameter registry/CLI, and integrate composite action. | DevOps | `.github/actions/validate-config`, `.github/actions/check-runtime-config`, `config/workflows/required-secrets.json`, `config/workflows/runtime-parameters.json`, `scripts/checks/validate-config.mjs`, `scripts/checks/verify-runtime-config.mjs`, `package.json` | Validation fails fast with remediation hints; registry enumerates parameters; CLI outputs GitHub summary; workflows invoke composite. | `npm run test:actions`, `npm test` (CLI/unit), `npm run runtime:verify` | Workflow Inventory Guard, Vendor Manifest Locking | ✅ Done |
| P0 | Log Persistence Hardening ([Design §3.5](design.md#35-failure-safe-log-persistence-ac5)) | Improve `.github/actions/persist-progress` commit + artifact fallback, and retrofit workflows. | DevOps / Ops | `.github/actions/persist-progress`, `scripts/logs/archive.mjs`, `.github/workflows/line-event.yml`, `.github/workflows/manus-progress.yml`, guardrail workflows | Composite stages commit, falls back to artifacts with retention notice; Step Summary documents result across workflows. | `npm run test:actions` (persist action), `npm test` (archive unit), manual dry run | Config Validation & Runtime Registry | ✅ Done |
| P1 | CI Coverage & Smoke Tests ([Design §3.6](design.md#36-automated-checks--coverage-ac6)) | Enforce expanded CI suite and optional `act` smoke job. | QA / DevOps | `.github/workflows/node-tests.yml`, `ci-smoke-act.yml` (new), `package.json`, test fixtures | CI runs lint, unit, action tests, vendor verify; smoke workflow documented and label-gated; status checks updated. | CI pipeline, `act` smoke with sanitized secrets | Log Persistence Hardening | ✅ Done |
| P1 | Metrics & Observability Upgrade ([Design §3.9](design.md#39-metrics--observability-ac9)) | Standardize Gemini metrics capture, aggregation, and artifacts. | Data/Analytics | `scripts/automation/run-gemini-log-summary.mjs`, `scripts/automation/report-gemini-metrics.mjs`, `gemini-metrics*.yml`, `logs/metrics/**` | Metrics recorded in JSONL + Markdown summary; nightly workflow uploads artifacts via persistence; docs updated with retrieval steps. | `npm test` (metrics unit), `npm run test:actions` (if composite added), workflow dry run | Log Persistence Hardening, CI Coverage | ✅ Done |
| P1 | Runbook & Knowledge Transfer ([Design §3.7](design.md#37-external-maintenance-runbook-ac7)) | Publish external maintenance runbook and parameter tables. | Ops / Docs | `docs/runbooks/line-actions.md`, `docs/operations/runtime-config.md`, `.sdd/steering/tech.md`, `README.md` | Runbook covers worktree setup, flag toggles, degraded recovery, verification scripts; linked from failure notices and steering doc. | Documentation lint/build (if available), stakeholder sign-off | Config Validation & Runtime Registry | Not Started |
| P2 | Deployment & Sign-off ([Design §7](design.md#7-deployment--migration-plan), [§9](design.md#9-dependencies--follow-ups)) | Execute rollout sequence, secure approvals, archive outcomes. | DevOps Lead / Compliance | `docs/releases/line-actions-hardening.md`, `docs/runbooks/line-actions.md`, `.sdd/specs/line-actions-hardening/design.md` | Migration steps documented、チェックリスト作成済み、サイン欄で承認を記録可能。 | `npm run test:actions`, `npm run workflows:check` | All preceding tasks | ✅ Ready for approval |

## Sequencing & Ownership
- **Phase 1 (P0)**: Start with `Workflow Inventory Guard`, `Vendor Manifest Locking`, `Router Consolidation Polish`, and `Config Validation & Runtime Registry`. Inventory provides context for routing and validation updates; manifest locking ensures downstream tasks rely on stable helpers.
- **Phase 2 (late P0 → P1)**: `Log Persistence Hardening` depends on improved validation; once stable, proceed with `CI Coverage & Smoke Tests` to enforce quality gates. These unlock downstream observability work.
- **Phase 3 (P1)**: `Metrics & Observability Upgrade` and `Runbook & Knowledge Transfer` can run partially in parallel once persistence and registry pieces are in place. Coordinate with Ops for documentation review.
- **Phase 4 (P2)**: `Deployment & Sign-off` follows successful completion of earlier tasks, culminating in stakeholder approval.

Parallel opportunities:
- Inventory and vendor locking can run concurrently.
- Metrics work may start once persistence API is finalized, even while runbook drafting begins (shared reviewers permitting).

## Potential Blockers
- **PAT provisioning**: Requires repo admin to supply an environment-protected token with `contents:write` before log persistence task can be validated.
- **Compliance retention approval**: Metrics/log artifact retention must be signed off; delay impacts deployment task.
- **Runner capacity for `act`**: If CI runners lack Docker support, smoke job may need alternative hosts.
- **Ops availability**: Runbook sign-off and parameter ownership assignments depend on Ops/Docs bandwidth.

Refer to the design document for deeper context and acceptance criteria alignment. This task list is the living source during `/sdd-implement`.
