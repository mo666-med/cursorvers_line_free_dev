# LINE Richmenu Front Buttons – Tasks

Primary references: [docs/design/line-richmenu/README.md](../../../docs/design/line-richmenu/README.md) and [docs/design/line-richmenu/message-flow.md](../../../docs/design/line-richmenu/message-flow.md). Each task below ties back to a specific section so `/sdd-implement` can trace requirements directly to design intent.

| Priority | Task (Design Ref) | Objective | Owner | Files / Modules | Definition of Done | Validation & Tests | Dependencies / Parallel Notes | Status |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| P0 | Richmenu Asset Packaging & QA ([README – 同梱ファイル](../../../docs/design/line-richmenu/README.md#同梱ファイル), [README – カラーパレット](../../../docs/design/line-richmenu/README.md#カラーパレット)) | Produce the 2× PNG export, color tokens, and lint to guarantee the SVG assets match design specs before deployment | Design/Frontend | `docs/design/line-richmenu/front-menu.svg`, `dist/front-menu.png`, `scripts/automation/build-line-assets.mjs` | Automated script exports retina PNG + hover variant, records checksum + metadata in repo | `npm run test:assets` verifies dimensions/hex palette; visual diff CI artifact | Unblocks all downstream registration tasks; can run in parallel with placeholder sync | In Progress |
| P0 | Registration Automation & Token Handling ([README – リッチメニュー登録手順](../../../docs/design/line-richmenu/README.md#リッチメニュー登録手順)) | Wire CLI + GH Actions to upload JSON + PNG, apply default menu, and expose dry-run for staging | DevOps | `scripts/automation/register-line-richmenu.mjs`, `.github/workflows/richmenu-register.yml` (new), `package.json` scripts | Command `npm run richmenu:register` accepts overrides, uploads assets, applies default, logs menu id | `act -W .github/workflows/richmenu-register.yml`, `npm run test:actions -- --case richmenu-register` | Depends on asset packaging being ready; can proceed before spec wiring | Not Started |
| P0 | Flex Template Build & Delivery Pipeline ([README – Flexテンプレート送信例](../../../docs/design/line-richmenu/README.md#flexテンプレート送信例), [README – シナリオ配信](../../../docs/design/line-richmenu/README.md#シナリオ配信-テキストflexのまとめ送り)) | Compile `flex-*` + scenario JSON into `config/line/templates`, ready for spec-triggered replies | Backend/Automation | `docs/design/line-richmenu/flex-*.json`, `docs/design/line-richmenu/scenarios/*.json`, `scripts/automation/build-line-templates.mjs`, `config/line/templates/*.json`, `scripts/orchestration/reply-line-templates.mjs` | `npm run line:templates` builds scenario files with resolved assets + quick replies, storing manifest in `config/line/templates` | `node --test tests/line/templates.test.mjs`, `npm run test:actions -- --case scenario-build` verifies payload structure | Parallel with registration once placeholder sync exists; required before spec mapping | Not Started |
| P0 | Quick Reply Catalog & Guardrails ([README – Quick Replyテンプレ](../../../docs/design/line-richmenu/README.md#quick-replyテンプレ), [Message Flow – 推奨Quick Replyセット](../../../docs/design/line-richmenu/message-flow.md#推奨quick-replyセット)) | Deliver reusable quick reply set and attach it to relevant replies with opt-out controls | Messaging/UX | `docs/design/line-richmenu/quick-reply.json`, `config/line/templates/quick-reply.json`, `codex.spec.yaml`, `scripts/orchestration/reply-line-templates.mjs` | Quick replies stored once, referenced by scenarios, and spec toggles ensure they only appear for eligible events | `node --test tests/line/quick-reply.test.mjs`, `npm run test:actions -- --case quick-reply` ensures payload limit + ordering | Requires template build pipeline; unblocks scenario mapping | In Progress |
| P0 | Scenario ↔ Spec Mapping ([README – Spec連携](../../../docs/design/line-richmenu/README.md#spec連携), [Message Flow – トリガー別メッセージ案](../../../docs/design/line-richmenu/message-flow.md#トリガー別メッセージ案)) | Connect `add_line`, `cmd_detail`, `cmd_gift`, `cmd_contact` events to scenario templates + limits inside `codex.spec.yaml` | Backend/Platform | `codex.spec.yaml`, `scripts/orchestration/evaluate-line-event.mjs`, `config/line/templates/scenario_*.json`, `.github/workflows/line-event.yml` | Spec rules load the compiled templates, enforce cooldowns, and emit scenario ids in evaluation result | `npm run lint:spec`, `npm run test:actions -- --case cmd-detail`, `act -W .github/workflows/line-event.yml` | Needs template + quick reply artifacts; can run parallel with copy localization | Not Started |
| P1 | Command Copy & Personalization Variables ([Message Flow – テキストテンプレ案](../../../docs/design/line-richmenu/message-flow.md#テキストテンプレ案), [README – カスタマイズのヒント](../../../docs/design/line-richmenu/README.md#カスタマイズのヒント)) | Externalize text blocks (detail/gift/contact) with placeholders for passwords, CTA, etc., and document update path | Content/Localization | `docs/design/line-richmenu/message-flow.md`, `config/line/templates/scenario_cmd_*.json`, `.env.example`, Supabase `line_templates` table (if used) | Copy strings live in single source with variables; editors can update without touching code; password fetched from env/DB | `node --test tests/line/scenario-copy.test.mjs`, manual QA script sending each scenario via `npm run line:scenario -- --dry-run` | Depends on scenario mapping + placeholder sync; parallelizable once templates exist | Not Started |
| P1 | URL & Secret Placeholder Sync ([README – URLプレースホルダー](../../../docs/design/line-richmenu/README.md#urlプレースホルダー), [Message Flow – 実装メモ](../../../docs/design/line-richmenu/message-flow.md#実装メモ)) | Ensure Manus/export-config populates LINE_* URLs + password envs before template build & Actions runs | Platform | `scripts/manus/export-config.mjs`, `scripts/orchestration/reply-line-templates.mjs`, `.github/workflows/line-event.yml`, `docs/ENV_VAR_SETUP.md`, `config/workflows/runtime-parameters.json` | GH Actions writes placeholders to `$GITHUB_ENV`, template build consumes them, fallback defaults logged; docs updated | `npm run runtime:verify`, `node --test tests/orchestration/placeholders.test.mjs` simulate missing envs, verify warnings | Should start early; required before template build to avoid example.com leaking | Not Started |
| P1 | Ops Runbook & Rollout Playbook ([README – リッチメニュー登録手順](../../../docs/design/line-richmenu/README.md#リッチメニュー登録手順), [README – シナリオ配信](../../../docs/design/line-richmenu/README.md#シナリオ配信-テキストflexのまとめ送り), [README – カスタマイズのヒント](../../../docs/design/line-richmenu/README.md#カスタマイズのヒント)) | Document PNG export, CLI usage, scenario QA, and fallback plan so Ops can ship updates safely | Ops | `docs/runbooks/line-richmenu.md` (new), `RUNBOOK.md`, `docs/design/line-richmenu/**`, `logs/progress/` | Runbook merged with screenshots + step-by-step, Ops dry-run recorded, degraded recovery + customization steps covered | Runbook sign-off checklist, `act` dry-run evidence attached to PR | Final task; depends on registration, template build, scenario mapping | Not Started |

## Notes & Potential Blockers
- Asset export requires confirming the SVG’s linked fonts/license before automating (Design needs to drop replacements or package outlines). Without that, Registration automation cannot run in CI.
- Placeholder sync depends on Manus API stability; if API does not expose `line_case_studies_url` yet, add a Supabase fallback per message-flow implementation memo.
- Scenario mapping assumes `codex.spec.yaml` already ingests `scenario_cmd_*` templates. If spec support is missing, create a precursor task to extend the rule engine dispatch format.
- Quick reply payload plus Flex responses may hit LINE size limits when combined with broadcast flags; bake limit checks into tests to avoid runtime failures.
- Ops runbook must include instructions for updating the password/CTA text; coordinate with Content so rotation SLAs are documented.
