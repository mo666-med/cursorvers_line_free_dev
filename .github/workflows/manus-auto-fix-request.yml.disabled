name: Manus Auto Fix Request

on:
  workflow_dispatch:

jobs:
  request:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Create Manus Task
        env:
          MANUS_API_KEY: ${{ secrets.MANUS_API_KEY }}
          MANUS_BASE_URL: ${{ vars.MANUS_BASE_URL }}
        run: |
          cat > /tmp/brief.md <<'EOF'
          # Manus Auto Fix Request
          監査失敗→自動修正→Manusフォールバックの仕組みを構築してください。
          - auto-fixスクリプト追加
          - manus-audit-*.yml更新
          - Bad credentials検出追加
          - ドキュメント更新
          EOF

          cat > /tmp/plan.json <<'EOF'
          {
            "title": "Manus auto-fix integration",
            "version": "1.0.0",
            "risk": { "level": "medium", "reasons": ["workflow changes", "auto-fix scripts"] },
            "steps": [
              { "id": "s1", "action": "add auto-fix script" },
              { "id": "s2", "action": "update audit workflows" },
              { "id": "s3", "action": "update error detection" },
              { "id": "s4", "action": "update documentation" }
            ]
          }
          EOF

          node scripts/manus-api.js create /tmp/brief.md /tmp/plan.json
