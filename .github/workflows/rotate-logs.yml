name: Rotate Logs
x-owner: devops

on:
  schedule:
    # æ¯Žé€±æœˆæ›œæ—¥ã®åˆå‰3æ™‚ï¼ˆJSTï¼‰ã«å®Ÿè¡Œ
    - cron: '0 18 * * 1'  # UTC 18:00 = JST 03:00 (next day)
  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

jobs:
  rotate:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒŸãƒƒãƒˆã«å¿…è¦
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # å…¨å±¥æ­´ã‚’å–å¾—
    
      - name: Setup Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
    
      - name: Rotate logs
        env:
          GITHUB_ACTIONS: true
        run: |
          chmod +x scripts/rotate-logs.sh
          ./scripts/rotate-logs.sh
    
      - name: Summary
        run: |
          echo "## ðŸ“‹ Log Rotation Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œäº†ã—ã¾ã—ãŸã€‚" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "è©³ç´°ã¯ã‚³ãƒŸãƒƒãƒˆãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚" >> $GITHUB_STEP_SUMMARY


